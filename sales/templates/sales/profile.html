<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Личный кабинет — BookVibe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .bg-gradient-soft { background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); }
    </style>
</head>
<body class="bg-gradient-soft text-slate-900 min-h-screen">

    <!-- Навигация (Синхронизирована с каталогом и главной) -->
    <nav class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-6 h-20 flex justify-between items-center">
            <a href="{% url 'catalog:index' %}" class="flex items-center gap-2 group">
                <div class="bg-indigo-600 text-white p-2 rounded-xl shadow-lg shadow-indigo-200 transition-transform group-hover:scale-105">
                    <i class="fas fa-book-open"></i>
                </div>
                <span class="text-2xl font-bold tracking-tight">Book<span class="text-indigo-600">Vibe</span></span>
            </a>
            <div class="flex items-center gap-6">
                <!-- ИСПРАВЛЕННАЯ ССЫЛКА НА КАТАЛОГ -->
                <a href="{% url 'catalog:book_list' %}" class="text-slate-600 hover:text-indigo-600 font-bold text-sm uppercase tracking-widest transition-colors">Каталог</a>
                
                <div class="h-8 w-[1px] bg-slate-200 mx-2 hidden md:block"></div>
                
                <!-- Кнопка выхода -->
                <a href="{% url 'sales:logout' %}" class="bg-rose-50 text-rose-600 px-5 py-2 rounded-xl font-bold hover:bg-rose-100 transition-all flex items-center gap-2">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="hidden sm:inline">Выйти</span>
                </a>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-6 py-12">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Левая колонка: Профиль -->
            <div class="lg:col-span-1">
                <div class="glass-card rounded-[2.5rem] p-8 shadow-sm border border-white sticky top-28">
                    <div class="text-center mb-8">
                        <div class="w-24 h-24 bg-indigo-600 rounded-[2rem] mx-auto mb-4 flex items-center justify-center text-white shadow-2xl shadow-indigo-200">
                            <i class="fas fa-user-circle text-5xl"></i>
                        </div>
                        <h2 class="text-2xl font-black text-slate-800 leading-tight">
                            {{ customer.first_name }}<br>{{ customer.last_name }}
                        </h2>
                        <p class="text-indigo-600 font-bold mt-1 uppercase tracking-widest text-[10px]">Покупатель</p>
                    </div>

                    <div class="space-y-3">
                        <div class="flex items-center gap-4 p-4 rounded-2xl bg-slate-50 border border-slate-100 overflow-hidden">
                            <i class="fas fa-phone text-slate-400"></i>
                            <span class="text-sm font-semibold text-slate-600 truncate">{{ customer.phone }}</span>
                        </div>
                    </div>
                    
                    <!-- ИСПРАВЛЕННАЯ КНОПКА "ИЗМЕНИТЬ" -->
                    <a href="{% url 'sales:edit_profile' %}" class="block w-full text-center mt-8 py-4 bg-slate-900 text-white rounded-2xl font-bold hover:bg-slate-800 transition-all active:scale-95 shadow-xl shadow-slate-200">
                        <i class="fas fa-edit mr-2 text-slate-400"></i> Изменить данные
                    </a>
                </div>
            </div>

            <!-- Правая колонка: История чеков -->
            <div class="lg:col-span-2 space-y-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-3xl font-black text-slate-800 tracking-tight">История покупок</h3>
                    <div class="bg-white px-4 py-2 rounded-2xl border border-slate-200 text-sm font-bold text-slate-500 shadow-sm">
                        {{ sales.count }} заказов
                    </div>
                </div>

                {% if sales %}
                    <div class="space-y-4">
                        {% for sale in sales %}
                        <div class="bg-white p-6 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-md transition-all">
                            <div class="flex flex-col sm:flex-row justify-between items-start gap-4 mb-4">
                                <div>
                                    <span class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Чек №{{ sale.id }}</span>
                                    <p class="text-sm text-slate-500 font-medium">{{ sale.sale_date|date:"d E Y, H:i" }}</p>
                                </div>
                                <div class="text-left sm:text-right w-full sm:w-auto">
                                    <p class="text-2xl font-black text-slate-900">{{ sale.total_amount }} ₽</p>
                                    <span class="inline-block text-[10px] text-emerald-500 font-bold bg-emerald-50 px-2 py-1 rounded-lg uppercase">Оформлен</span>
                                </div>
                            </div>

                            <div class="space-y-2 pt-4 border-t border-slate-50">
                                {% for item in sale.items.all %}
                                <div class="flex justify-between text-sm gap-4">
                                    <span class="text-slate-600 font-medium">
                                        <span class="text-slate-900">{{ item.book.title }}</span>
                                        <span class="text-slate-300 mx-1">×</span> {{ item.quantity }}
                                    </span>
                                    <span class="font-bold text-slate-800 whitespace-nowrap">{{ item.price_at_sale }} ₽</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <!-- ИСПРАВЛЕННАЯ КНОПКА В ПУСТОМ СОСТОЯНИИ -->
                    <div class="bg-white/50 rounded-[3rem] p-12 md:p-20 text-center border-4 border-dashed border-slate-200/50">
                        <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-300">
                            <i class="fas fa-shopping-basket text-3xl"></i>
                        </div>
                        <h4 class="text-xl font-bold text-slate-400">Здесь пока пусто</h4>
                        <p class="text-slate-400 mt-2 mb-8">Самое время заглянуть в наш каталог за новинками!</p>
                        <a href="{% url 'catalog:book_list' %}" class="inline-block bg-indigo-600 text-white px-8 py-4 rounded-2xl font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-100 active:scale-95">
                            Перейти в каталог
                        </a>
                    </div>
                {% endif %}
            </div>

        </div>
    </main>

    <footer class="py-12 text-center">
        <p class="text-slate-400 text-sm font-medium">BookVibe &copy; 2024. Все права защищены.</p>
    </footer>

</body>
</html>